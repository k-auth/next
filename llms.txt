# K-Auth

> 설정 한 줄, 버튼 한 줄, 에러는 한국어로. (v0.2.0)

Next.js에서 카카오, 네이버, 구글, 애플 로그인을 가장 쉽게 구현하세요.
next-auth(Auth.js) v5를 래핑하여 한국 개발자를 위한 편의 기능을 제공합니다.

## 왜 K-Auth인가요?

next-auth에 카카오/네이버 Provider가 있긴 해요. 그런데 직접 써보면:

- 네이버가 갑자기 안 돼요 - `expires_in` 타입 에러 (네이버가 OAuth 스펙을 안 지켜서 생김)
- scope가 뭔지 모르겠어요 - 전화번호는 `phone_number`? `account/phone`?
- 버튼을 또 만들어야 해요 - 카카오 노란색이 `#FEE500`인가 `#FFEB00`인가...
- 에러가 영어예요 - `Invalid redirect_uri`가 뭔데...

K-Auth는 이런 삽질을 대신 해뒀어요.

## 주요 기능

- 카카오/네이버/구글/애플 OAuth Provider 내장 (네이버 버그 수정됨)
- 공식 디자인 가이드를 준수한 로그인 버튼 컴포넌트
- 한국어 에러 메시지
- `collect: { phone: true }` 같은 직관적인 옵션으로 scope 자동 설정
- next-auth 완벽 호환 (GitHub, Discord 등 함께 사용 가능)

## 설치

```bash
npm install @k-auth/next
```

## 빠른 시작

```typescript
// auth.ts
import { KAuth } from '@k-auth/next';

export const { handlers, auth, signIn, signOut } = KAuth({
  kakao: {
    clientId: process.env.KAKAO_CLIENT_ID!,
    clientSecret: process.env.KAKAO_CLIENT_SECRET!,
    collect: { email: true, profile: true },
  },
  naver: {
    clientId: process.env.NAVER_CLIENT_ID!,
    clientSecret: process.env.NAVER_CLIENT_SECRET!,
  },
});
```

```typescript
// app/api/auth/[...nextauth]/route.ts
import { handlers } from '@/auth';
export const { GET, POST } = handlers;
```

```tsx
// 로그인 버튼
import { Button } from '@k-auth/next/ui';
import { signIn } from '@/auth';

<Button.Kakao onClick={() => signIn('kakao')} />
<Button.Naver onClick={() => signIn('naver')} />
```

## API

### KAuth(config)

메인 설정 함수. next-auth의 handlers, auth, signIn, signOut을 반환합니다.

**카카오 옵션:**
- `kakao.clientId` - 카카오 REST API 키 (필수)
- `kakao.clientSecret` - 카카오 Client Secret (필수)
- `kakao.collect.email` - 이메일 수집
- `kakao.collect.profile` - 프로필 수집
- `kakao.collect.phone` - 전화번호 수집
- `kakao.collect.birthday` - 생년월일 수집
- `kakao.collect.gender` - 성별 수집
- `kakao.collect.ageRange` - 연령대 수집

**네이버 옵션:**
- `naver.clientId` - 네이버 Client ID (필수)
- `naver.clientSecret` - 네이버 Client Secret (필수)
- `naver.collect.*` - 문서화 목적 (네이버는 scope 미지원, 개발자센터에서 직접 설정)

**구글 옵션:**
- `google.clientId` - 구글 Client ID (필수)
- `google.clientSecret` - 구글 Client Secret (필수)
- `google.collect.email` - 이메일 수집
- `google.collect.profile` - 프로필 수집
- `google.forceConsent` - 매번 동의 화면 표시

**애플 옵션:**
- `apple.clientId` - 애플 Services ID (필수)
- `apple.clientSecret` - 애플 Client Secret JWT (필수)
- `apple.collect.email` - 이메일 수집
- `apple.collect.name` - 이름 수집 (최초 로그인 시에만 제공)

### Button 컴포넌트

```tsx
import { Button } from '@k-auth/next/ui';

<Button.Kakao />  // 카카오 로그인 버튼
<Button.Naver />  // 네이버 로그인 버튼
<Button.Google /> // 구글 로그인 버튼
<Button.Apple />  // 애플 로그인 버튼
<Button.Group />  // 버튼 그룹

// 크기: size="sm" | "default" | "lg" | "icon"
```

## 환경 변수

```env
KAKAO_CLIENT_ID=
KAKAO_CLIENT_SECRET=
NAVER_CLIENT_ID=
NAVER_CLIENT_SECRET=
GOOGLE_CLIENT_ID=
GOOGLE_CLIENT_SECRET=
APPLE_CLIENT_ID=
APPLE_CLIENT_SECRET=

AUTH_SECRET=         # openssl rand -base64 32
AUTH_TRUST_HOST=true # 배포 환경 필수
```

## 요구사항

- Next.js 14+
- React 18+

## 링크

- npm: https://www.npmjs.com/package/@k-auth/next
