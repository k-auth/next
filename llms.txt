# K-Auth

> 한국형 소셜 로그인 라이브러리 for Next.js

K-Auth는 카카오, 네이버 로그인을 Next.js에서 가장 쉽게 구현할 수 있는 라이브러리입니다.
next-auth(Auth.js)를 래핑하여 한국 개발자를 위한 편의 기능을 제공합니다.

## 주요 기능

- 카카오/네이버 OAuth provider 내장 (next-auth 공식 미지원)
- 공식 디자인 가이드를 준수한 로그인 버튼 컴포넌트
- 한국어 에러 메시지
- `collectPhone: true` 같은 직관적인 옵션으로 scope 자동 설정
- next-auth 완벽 호환 (구글, 애플, GitHub 등 함께 사용 가능)

## 설치

```bash
npm install @relkimm/k-auth
```

## 빠른 시작

### 1. auth.ts 생성

```typescript
// auth.ts
import { KAuth } from '@relkimm/k-auth';

export const { handlers, auth, signIn, signOut } = KAuth({
  kakao: {
    clientId: process.env.KAKAO_CLIENT_ID!,
    clientSecret: process.env.KAKAO_CLIENT_SECRET!,
  },
  naver: {
    clientId: process.env.NAVER_CLIENT_ID!,
    clientSecret: process.env.NAVER_CLIENT_SECRET!,
  },
});
```

### 2. API 라우트 설정

```typescript
// app/api/auth/[...nextauth]/route.ts
import { handlers } from '@/auth';
export const { GET, POST } = handlers;
```

### 3. 로그인 버튼

```tsx
import { Button } from '@relkimm/k-auth/ui';
import { signIn } from '@/auth';

<Button.Group>
  <Button.Kakao onClick={() => signIn('kakao')} />
  <Button.Naver onClick={() => signIn('naver')} />
</Button.Group>
```

### 4. 세션 확인

```tsx
import { auth } from '@/auth';

export default async function Page() {
  const session = await auth();
  if (!session) return <a href="/login">로그인</a>;
  return <p>안녕하세요, {session.user?.name}님!</p>;
}
```

## API Reference

### KAuth(config)

메인 설정 함수. next-auth의 handlers, auth, signIn, signOut을 반환합니다.

**카카오 옵션:**
- `kakao.clientId` - 카카오 REST API 키 (필수)
- `kakao.clientSecret` - 카카오 Client Secret (필수)
- `kakao.collectPhone` - 전화번호 수집 (scope 자동 추가)
- `kakao.collectBirth` - 생년월일 수집
- `kakao.collectGender` - 성별 수집
- `kakao.collectAgeRange` - 연령대 수집

**네이버 옵션:**
- `naver.clientId` - 네이버 Client ID (필수)
- `naver.clientSecret` - 네이버 Client Secret (필수)
- `naver.collectPhone` - 전화번호 수집
- `naver.collectBirth` - 생년월일 수집
- `naver.collectGender` - 성별 수집
- `naver.collectName` - 실명 수집

**next-auth 설정:**
- `nextAuthConfig` - next-auth 고급 설정 (providers, callbacks, adapter 등)

### Button 컴포넌트

```tsx
import { Button } from '@relkimm/k-auth/ui';
```

- `Button.Kakao` - 카카오 로그인 버튼
- `Button.Naver` - 네이버 로그인 버튼
- `Button.Google` - 구글 로그인 버튼
- `Button.Apple` - 애플 로그인 버튼
- `Button.Group` - 버튼 그룹 (direction, gap 옵션)

**크기 옵션:**
- `size="sm"` - 작은 버튼
- `size="default"` - 기본 크기
- `size="lg"` - 큰 버튼
- `size="icon"` - 아이콘만

### 에러 처리

```typescript
import { KAuthError } from '@relkimm/k-auth';

try {
  // ...
} catch (error) {
  if (error instanceof KAuthError) {
    console.log(error.code);    // 에러 코드
    console.log(error.message); // 한국어 메시지
    console.log(error.hint);    // 해결 힌트
  }
}
```

## 환경 변수

```env
KAKAO_CLIENT_ID=
KAKAO_CLIENT_SECRET=
NAVER_CLIENT_ID=
NAVER_CLIENT_SECRET=
AUTH_SECRET=  # openssl rand -base64 32
```

## 요구사항

- Next.js 14+
- React 18+

## 링크

- GitHub: https://github.com/relkimm/k-auth
- npm: https://www.npmjs.com/package/@relkimm/k-auth
