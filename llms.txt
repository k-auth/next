# K-Auth

> 한국형 소셜 로그인 라이브러리 for Next.js (v0.2.0)

K-Auth는 카카오, 네이버, 구글, 애플 로그인을 Next.js에서 가장 쉽게 구현할 수 있는 라이브러리입니다.
next-auth(Auth.js) v5를 래핑하여 한국 개발자를 위한 편의 기능을 제공합니다.

## 주요 기능

- 카카오/네이버/구글/애플 OAuth Provider 내장
- 공식 디자인 가이드를 준수한 로그인 버튼 컴포넌트
- 한국어 에러 메시지
- `collect: { phone: true }` 같은 직관적인 옵션으로 scope 자동 설정
- next-auth 완벽 호환 (GitHub, Discord 등 함께 사용 가능)

## 설치

```bash
npm install @k-auth/next
```

## 빠른 시작

### 1. auth.ts 생성

```typescript
// auth.ts
import { KAuth } from '@k-auth/next';

export const { handlers, auth, signIn, signOut } = KAuth({
  kakao: {
    clientId: process.env.KAKAO_CLIENT_ID!,
    clientSecret: process.env.KAKAO_CLIENT_SECRET!,
    collect: { email: true, profile: true },
  },
  naver: {
    clientId: process.env.NAVER_CLIENT_ID!,
    clientSecret: process.env.NAVER_CLIENT_SECRET!,
  },
});
```

### 2. API 라우트 설정

```typescript
// app/api/auth/[...nextauth]/route.ts
import { handlers } from '@/auth';
export const { GET, POST } = handlers;
```

### 3. 로그인 버튼

```tsx
import { Button } from '@k-auth/next/ui';
import { signIn } from '@/auth';

<Button.Group>
  <Button.Kakao onClick={() => signIn('kakao')} />
  <Button.Naver onClick={() => signIn('naver')} />
</Button.Group>
```

### 4. 세션 확인

```tsx
import { auth } from '@/auth';

export default async function Page() {
  const session = await auth();
  if (!session) return <a href="/login">로그인</a>;
  return <p>안녕하세요, {session.user?.name}님!</p>;
}
```

## API Reference

### KAuth(config)

메인 설정 함수. next-auth의 handlers, auth, signIn, signOut을 반환합니다.

**카카오 옵션:**
- `kakao.clientId` - 카카오 REST API 키 (필수)
- `kakao.clientSecret` - 카카오 Client Secret (필수)
- `kakao.collect.email` - 이메일 수집
- `kakao.collect.profile` - 프로필(닉네임, 이미지) 수집
- `kakao.collect.phone` - 전화번호 수집
- `kakao.collect.birthday` - 생년월일 수집
- `kakao.collect.gender` - 성별 수집
- `kakao.collect.ageRange` - 연령대 수집
- `kakao.collect.ci` - CI(연계정보) 수집 (카카오싱크 비즈니스 전용)

**네이버 옵션:**
- `naver.clientId` - 네이버 Client ID (필수)
- `naver.clientSecret` - 네이버 Client Secret (필수)
- `naver.collect.*` - 문서화 목적 (네이버는 scope 미지원, 개발자센터에서 직접 설정)

**구글 옵션:**
- `google.clientId` - 구글 Client ID (필수)
- `google.clientSecret` - 구글 Client Secret (필수)
- `google.collect.email` - 이메일 수집
- `google.collect.profile` - 프로필 수집
- `google.forceConsent` - 매번 동의 화면 표시 (refresh_token 획득용)

**애플 옵션:**
- `apple.clientId` - 애플 Services ID (필수)
- `apple.clientSecret` - 애플 Client Secret JWT (필수)
- `apple.collect.email` - 이메일 수집
- `apple.collect.name` - 이름 수집 (최초 로그인 시에만 제공)

**next-auth 설정:**
- `nextAuthConfig` - next-auth 고급 설정 (providers, callbacks, adapter 등)

### Button 컴포넌트

```tsx
import { Button } from '@k-auth/next/ui';
```

- `Button.Kakao` - 카카오 로그인 버튼
- `Button.Naver` - 네이버 로그인 버튼
- `Button.Google` - 구글 로그인 버튼
- `Button.Apple` - 애플 로그인 버튼
- `Button.Group` - 버튼 그룹 (direction, gap 옵션)

**크기 옵션:**
- `size="sm"` - 작은 버튼
- `size="default"` - 기본 크기
- `size="lg"` - 큰 버튼
- `size="icon"` - 아이콘만

## 환경 변수

```env
# Provider 설정
KAKAO_CLIENT_ID=
KAKAO_CLIENT_SECRET=
NAVER_CLIENT_ID=
NAVER_CLIENT_SECRET=
GOOGLE_CLIENT_ID=
GOOGLE_CLIENT_SECRET=
APPLE_CLIENT_ID=
APPLE_CLIENT_SECRET=

# NextAuth 필수
AUTH_SECRET=         # openssl rand -base64 32 로 생성
AUTH_TRUST_HOST=true # 배포 환경(Vercel 등)에서 필수
```

## 요구사항

- Next.js 14+
- React 18+

## 링크

- npm: https://www.npmjs.com/package/@k-auth/next
